-- å–µå–µè„šæœ¬ä¸­å¿ƒ v1.0 - å¯æ³¨å…¥ç‰ˆæœ¬
-- ä¿®å¤äº†åŸå§‹è„šæœ¬çš„å…¼å®¹æ€§é—®é¢˜

getgenv().MiaoMiao = {
    Version = "1.0",
    Loaded = false,
    Config = {
        AutoLoad = true,
        Notifications = true
    }
}

-- å®‰å…¨åŠ è½½å‡½æ•°
local function SafeLoadMiaoMiao()
    if getgenv().MiaoMiao.Loaded then
        return warn("ğŸ± å–µå–µè„šæœ¬å·²ç»åŠ è½½!")
    end
    
    -- ç­‰å¾…æ¸¸æˆåŠ è½½
    if not game:IsLoaded() then
        game.Loaded:Wait()
    end
    
    -- ç­‰å¾…ç©å®¶
    local Players = game:GetService("Players")
    local LocalPlayer = Players.LocalPlayer
    while not LocalPlayer do
        wait(1)
        LocalPlayer = Players.LocalPlayer
    end
    
    -- æ˜¾ç¤ºåŠ è½½é€šçŸ¥
    if getgenv().MiaoMiao.Config.Notifications then
        game:GetService("StarterGui"):SetCore("SendNotification", {
            Title = "å–µå–µè„šæœ¬",
            Text = "æ­£åœ¨åŠ è½½ v1.0...",
            Duration = 3
        })
    end
    
    print("ğŸš€ å¼€å§‹åŠ è½½å–µå–µè„šæœ¬ä¸­å¿ƒ v1.0...")
    
    -- è¿™é‡Œåº”è¯¥æ˜¯ä½ çš„ä¸»è¦è„šæœ¬å†…å®¹
    -- ç”±äºåŸå§‹è„šæœ¬å†…å®¹æœªçŸ¥ï¼Œæˆ‘åˆ›å»ºä¸€ä¸ªåŸºç¡€æ¡†æ¶
    
    -- åˆ›å»ºä¸»ç•Œé¢å‡½æ•°
    local function CreateMainInterface()
        -- åˆ›å»ºå±å¹•GUI
        local ScreenGui = Instance.new("ScreenGui")
        ScreenGui.Name = "MiaoMiaoMainUI"
        ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
        ScreenGui.Parent = game:GetService("CoreGui")
        
        -- ä¸»çª—å£
        local MainFrame = Instance.new("Frame")
        MainFrame.Size = UDim2.new(0, 400, 0, 300)
        MainFrame.Position = UDim2.new(0.5, -200, 0.5, -150)
        MainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
        MainFrame.BorderSizePixel = 0
        MainFrame.Parent = ScreenGui
        
        local UICorner = Instance.new("UICorner")
        UICorner.CornerRadius = UDim.new(0, 8)
        UICorner.Parent = MainFrame
        
        -- æ ‡é¢˜æ 
        local TitleBar = Instance.new("Frame")
        TitleBar.Size = UDim2.new(1, 0, 0, 40)
        TitleBar.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
        TitleBar.Parent = MainFrame
        
        local TitleLabel = Instance.new("TextLabel")
        TitleLabel.Size = UDim2.new(0, 200, 1, 0)
        TitleLabel.Position = UDim2.new(0, 15, 0, 0)
        TitleLabel.BackgroundTransparency = 1
        TitleLabel.Text = "ğŸ± å–µå–µè„šæœ¬ä¸­å¿ƒ v1.0"
        TitleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
        TitleLabel.TextSize = 16
        TitleLabel.Font = Enum.Font.GothamBold
        TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
        TitleLabel.Parent = TitleBar
        
        -- å…³é—­æŒ‰é’®
        local CloseButton = Instance.new("TextButton")
        CloseButton.Size = UDim2.new(0, 30, 0, 30)
        CloseButton.Position = UDim2.new(1, -35, 0, 5)
        CloseButton.BackgroundColor3 = Color3.fromRGB(255, 60, 60)
        CloseButton.Text = "Ã—"
        CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
        CloseButton.TextSize = 20
        CloseButton.Font = Enum.Font.GothamBold
        CloseButton.Parent = TitleBar
        
        local CloseCorner = Instance.new("UICorner")
        CloseCorner.CornerRadius = UDim.new(0, 6)
        CloseCorner.Parent = CloseButton
        
        -- å†…å®¹åŒºåŸŸ
        local ContentFrame = Instance.new("ScrollingFrame")
        ContentFrame.Size = UDim2.new(1, -20, 1, -60)
        ContentFrame.Position = UDim2.new(0, 10, 0, 50)
        ContentFrame.BackgroundTransparency = 1
        ContentFrame.ScrollBarThickness = 3
        ContentFrame.Parent = MainFrame
        
        local UIListLayout = Instance.new("UIListLayout")
        UIListLayout.Padding = UDim.new(0, 10)
        UIListLayout.Parent = ContentFrame
        
        -- æ·»åŠ åŠŸèƒ½æŒ‰é’®
        local function CreateButton(text, callback)
            local Button = Instance.new("TextButton")
            Button.Size = UDim2.new(1, 0, 0, 40)
            Button.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
            Button.Text = text
            Button.TextColor3 = Color3.fromRGB(255, 255, 255)
            Button.TextSize = 14
            Button.Font = Enum.Font.Gotham
            Button.Parent = ContentFrame
            
            local ButtonCorner = Instance.new("UICorner")
            ButtonCorner.CornerRadius = UDim.new(0, 6)
            ButtonCorner.Parent = Button
            
            Button.MouseButton1Click:Connect(callback)
            return Button
        end
        
        -- ç¤ºä¾‹åŠŸèƒ½æŒ‰é’®
        CreateButton("è‡ªåŠ¨å†œåœº", function()
            game:GetService("StarterGui"):SetCore("SendNotification", {
                Title = "å–µå–µè„šæœ¬",
                Text = "è‡ªåŠ¨å†œåœºåŠŸèƒ½å¯åŠ¨",
                Duration = 3
            })
        end)
        
        CreateButton("ç©å®¶ä¼ é€", function()
            local player = game.Players.LocalPlayer
            if player.Character then
                local hrp = player.Character:FindFirstChild("HumanoidRootPart")
                if hrp then
                    hrp.CFrame = CFrame.new(0, 50, 0)
                end
            end
        end)
        
        CreateButton("å¤åˆ¶æ¸¸æˆID", function()
            setclipboard(tostring(game.PlaceId))
            game:GetService("StarterGui"):SetCore("SendNotification", {
                Title = "ä¿¡æ¯",
                Text = "æ¸¸æˆIDå·²å¤åˆ¶!",
                Duration = 2
            })
        end)
        
        CreateButton("å…³é—­ç•Œé¢", function()
            ScreenGui:Destroy()
        end)
        
        -- å…³é—­æŒ‰é’®äº‹ä»¶
        CloseButton.MouseButton1Click:Connect(function()
            ScreenGui:Destroy()
        end)
        
        -- çª—å£æ‹–åŠ¨
        local dragging, dragStart, startPos
        TitleBar.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                dragging = true
                dragStart = input.Position
                startPos = MainFrame.Position
            end
        end)
        
        game:GetService("UserInputService").InputChanged:Connect(function(input)
            if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
                local delta = input.Position - dragStart
                MainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
            end
        end)
        
        TitleBar.InputEnded:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                dragging = false
            end
        end)
        
        print("âœ… å–µå–µè„šæœ¬ç•Œé¢åˆ›å»ºå®Œæˆ!")
        return ScreenGui
    end
    
    -- æ‰§è¡Œä¸»è¦åŠŸèƒ½
    local success, err = pcall(function()
        -- åˆ›å»ºä¸»ç•Œé¢
        getgenv().MiaoMiaoUI = CreateMainInterface()
        
        -- æ ‡è®°ä¸ºå·²åŠ è½½
        getgenv().MiaoMiao.Loaded = true
        
        -- æ˜¾ç¤ºæˆåŠŸé€šçŸ¥
        if getgenv().MiaoMiao.Config.Notifications then
            game:GetService("StarterGui"):SetCore("SendNotification", {
                Title = "å–µå–µè„šæœ¬",
                Text = "v1.0 åŠ è½½æˆåŠŸ!",
                Duration = 3
            })
        end
        
        print("ğŸ‰ å–µå–µè„šæœ¬ä¸­å¿ƒ v1.0 åŠ è½½å®Œæˆ!")
    end)
    
    if not success then
        warn("âŒ å–µå–µè„šæœ¬åŠ è½½å¤±è´¥: " .. tostring(err))
        if getgenv().MiaoMiao.Config.Notifications then
            game:GetService("StarterGui"):SetCore("SendNotification", {
                Title = "å–µå–µè„šæœ¬",
                Text = "åŠ è½½å¤±è´¥: " .. tostring(err),
                Duration = 5
            })
        end
    end
end

-- è‡ªåŠ¨åŠ è½½
if getgenv().MiaoMiao.Config.AutoLoad then
    spawn(SafeLoadMiaoMiao)
else
    -- æ‰‹åŠ¨åŠ è½½å‡½æ•°
    getgenv().LoadMiaoMiao = SafeLoadMiaoMiao
    print("ğŸ’¡ è¾“å…¥ LoadMiaoMiao() æ¥æ‰‹åŠ¨åŠ è½½å–µå–µè„šæœ¬")
end

-- è¿”å›åŠ è½½çŠ¶æ€
return {
    Version = getgenv().MiaoMiao.Version,
    Loaded = getgenv().MiaoMiao.Loaded,
    Load = SafeLoadMiaoMiao
}
